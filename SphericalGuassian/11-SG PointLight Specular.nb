(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     64230,       1501]
NotebookOptionsPosition[     62724,       1469]
NotebookOutlinePosition[     63067,       1484]
CellTagsIndexPosition[     63024,       1481]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "\"\<Global`*\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<gPlots`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Needs", "[", "\"\<gBRDF`\>\"", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gPrint", "[", "\"\<>NoL*FallOff*BRDF(Ground Lighting):\>\"", "]"}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{"Manipulate", "[", 
  RowBox[{
   RowBox[{"gParamPlot", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"<|", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"\"\<lines\>\"", "\[Rule]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{"<|", 
            RowBox[{
             RowBox[{"\"\<startPos\>\"", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0"}], "}"}]}], ",", "\[IndentingNewLine]", 
             "\t", 
             RowBox[{"\"\<dirVec\>\"", "\[Rule]", 
              RowBox[{"FromPolarCoordinates", "[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "#lineAngle"}], "}"}], "]"}]}], ",", 
             RowBox[{"\"\<length\>\"", "\[Rule]", "2"}]}], "|>"}], 
           "\[IndentingNewLine]", "}"}]}], "&"}], "[", 
        RowBox[{"<|", 
         RowBox[{"\"\<lineAngle\>\"", "\[Rule]", "viewAngle"}], "|>"}], "]"}],
        ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"\"\<circles\>\"", "\[Rule]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{"<|", 
            RowBox[{
             RowBox[{"\"\<center\>\"", "\[Rule]", "#lightCenter"}], ",", 
             RowBox[{"\"\<radius\>\"", "\[Rule]", "#lightRadius"}]}], "|>"}], 
           "\[IndentingNewLine]", "}"}]}], "&"}], "[", 
        RowBox[{"<|", 
         RowBox[{
          RowBox[{"\"\<lightCenter\>\"", "\[Rule]", "lightCenter"}], ",", 
          RowBox[{"\"\<lightRadius\>\"", "\[Rule]", "lightRadius"}]}], "|>"}],
         "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"\"\<groundShadings\>\"", "\[Rule]", 
          RowBox[{"{", "\[IndentingNewLine]", "    ", 
           RowBox[{"<|", 
            RowBox[{
             RowBox[{"\"\<lightCenter\>\"", "\[Rule]", "#lightCenter"}], ",", 
             RowBox[{"\"\<lightRadius\>\"", "\[Rule]", "#lightRadiusCtrl"}], 
             ",", "\[IndentingNewLine]", "\t", 
             RowBox[{"\"\<roughness\>\"", "\[Rule]", "#roughness"}], ",", 
             RowBox[{"\"\<viewDir\>\"", "\[Rule]", 
              RowBox[{"FromPolarCoordinates", "[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "#viewAngle"}], "}"}], "]"}]}], ",", 
             "\[IndentingNewLine]", "\t", 
             RowBox[{"\"\<shadingFunc\>\"", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"#nol", "*", 
                 RowBox[{"gPointLightFallOff", "[", 
                  RowBox[{"#lightRadius", ",", "#shadingDist"}], "]"}], "*", 
                 "\[IndentingNewLine]", "\t\t\t\t ", 
                 RowBox[{"gBrdfFunc", "[", 
                  RowBox[{
                  "#roughness", ",", "#normalDir", ",", "#lightDir", ",", 
                   "#viewDir"}], "]"}]}], "&"}], ")"}]}]}], "|>"}], 
           "\[IndentingNewLine]", "}"}]}], "&"}], "[", 
        RowBox[{"<|", 
         RowBox[{
          RowBox[{"\"\<lightCenter\>\"", "\[Rule]", "lightCenter"}], ",", 
          RowBox[{"\"\<lightRadiusCtrl\>\"", "\[Rule]", "lightRadius"}], ",", 
          "\[IndentingNewLine]", "\t\t", 
          RowBox[{"\"\<roughness\>\"", "\[Rule]", "roughness"}], ",", 
          RowBox[{"\"\<viewAngle\>\"", "\[Rule]", "viewAngle"}]}], "|>"}], 
        "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"\"\<axisExtent\>\"", "\[Rule]", "3"}]}], 
      "\[IndentingNewLine]", "|>"}], ",", "Medium"}], "]"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"lightCenter", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "2"}], ",", 
       RowBox[{"-", "2"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"lightRadius", ",", "2"}], "}"}], ",", "1", ",", "5"}], "}"}], 
   ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"roughness", ",", "0.2"}], "}"}], ",", "0.05", ",", "1"}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"viewAngle", ",", 
       RowBox[{"\[Pi]", "/", "4"}]}], "}"}], ",", "0", ",", "\[Pi]"}], "}"}], 
   ",", "\[IndentingNewLine]", 
   RowBox[{"Method", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"\"\<ShowControls\>\"", "\[Rule]", "True"}], "}"}]}]}], 
  "\[IndentingNewLine]", "]"}]}], "Input",
 CellChangeTimes->{{3.831159052131798*^9, 3.831159053077799*^9}, {
   3.831159106069352*^9, 3.831159130205224*^9}, {3.831159672764243*^9, 
   3.831159706356526*^9}, {3.8311597386357193`*^9, 3.831159766951304*^9}, {
   3.831160000165146*^9, 3.8311600468444233`*^9}, {3.8311602055552473`*^9, 
   3.8311602790608387`*^9}, {3.8311604106929083`*^9, 3.831160416125536*^9}, {
   3.831160561357197*^9, 3.8311606238928757`*^9}, {3.831179466705072*^9, 
   3.8311794668013735`*^9}, {3.8311800642572618`*^9, 
   3.8311800806969595`*^9}, {3.831181767119994*^9, 3.8311817673922815`*^9}, {
   3.8315323038321524`*^9, 3.8315323439200163`*^9}, {3.83153241245373*^9, 
   3.831532432657011*^9}, {3.831532465594139*^9, 3.8315325008478374`*^9}, {
   3.831532548439743*^9, 3.8315325880506916`*^9}, {3.831532666323696*^9, 
   3.8315326721957617`*^9}, 3.8315328270135136`*^9, {3.831532868730433*^9, 
   3.831532923021521*^9}, {3.8315329672312984`*^9, 3.831533022973257*^9}, 
   3.831533079531767*^9, {3.8315331213207455`*^9, 3.831533157591982*^9}, {
   3.8315332148827057`*^9, 3.8315332389589305`*^9}, {3.8315333591477413`*^9, 
   3.8315333858136735`*^9}, {3.8315334760207443`*^9, 
   3.8315334948399286`*^9}, {3.831533530110876*^9, 3.831533556610481*^9}, {
   3.8315335916324434`*^9, 3.8315336280913687`*^9}, {3.8315392893753285`*^9, 
   3.8315392903076067`*^9}, {3.831539336028604*^9, 3.8315394058985043`*^9}, {
   3.8315394698710256`*^9, 3.8315394832492867`*^9}, {3.831540484103381*^9, 
   3.8315405415896163`*^9}, {3.8315408150717373`*^9, 
   3.8315408428817854`*^9}, {3.831541010408637*^9, 3.8315410829619646`*^9}, {
   3.831541122268527*^9, 3.8315411273523073`*^9}},
 CellLabel->"In[89]:=",ExpressionUUID->"a553c2d9-ec9e-417a-9b05-f7e73d693e26"],

Cell[BoxData[
 StyleBox["\<\" >NoL*FallOff*BRDF(Ground Lighting):\"\>",
  StripOnInput->False,
  FontSize->18,
  Background->RGBColor[0.87, 0.94, 1]]], "Print",
 CellChangeTimes->{
  3.831159077945485*^9, 3.831159131365695*^9, 3.8311593277263927`*^9, 
   3.8311595949200773`*^9, {3.8311597443156323`*^9, 3.8311597677611294`*^9}, 
   3.8311599510570874`*^9, 3.8311602798028297`*^9, {3.8311604115344186`*^9, 
   3.831160416841527*^9}, {3.8311605781841173`*^9, 3.8311606246698303`*^9}, 
   3.8311624160351653`*^9, 3.8311792707987585`*^9, {3.831179459639826*^9, 
   3.8311794676699057`*^9}, 3.831180081595838*^9, 3.8311801219918966`*^9, {
   3.8311817614276285`*^9, 3.8311817679529667`*^9}, 3.8311826969639273`*^9, 
   3.831184259639001*^9, 3.8311865240683117`*^9, 3.8315317143022814`*^9, {
   3.8315324078307915`*^9, 3.831532433435873*^9}, {3.8315324661297565`*^9, 
   3.8315324788205633`*^9}, 3.8315325092851095`*^9, {3.831532565545598*^9, 
   3.8315325894387093`*^9}, {3.831532644661797*^9, 3.8315326727591763`*^9}, {
   3.8315327194663343`*^9, 3.831532827748692*^9}, {3.831532887018431*^9, 
   3.831532896921714*^9}, 3.831532940437038*^9, 3.8315329803507347`*^9, {
   3.83153302522379*^9, 3.8315330493686247`*^9}, {3.831533108344907*^9, 
   3.831533239806927*^9}, 3.831533520426691*^9, {3.831533557339035*^9, 
   3.8315336304960318`*^9}, 3.8315393107302494`*^9, 3.831540241748185*^9, 
   3.8315403237920814`*^9, {3.8315404853713756`*^9, 3.8315404967112103`*^9}, {
   3.831540529614541*^9, 3.8315405421275597`*^9}, 3.8315406404988346`*^9, 
   3.8315408238598413`*^9, {3.8315410466208878`*^9, 3.831541083796318*^9}, 
   3.831541127962865*^9},
 FontSize->18,
 CellLabel->
  "During evaluation of \
In[89]:=",ExpressionUUID->"182334f4-619e-47e8-aa7c-1982701672ba"],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`lightCenter$$ = {-1, 
    1}, $CellContext`lightRadius$$ = 2, $CellContext`roughness$$ = 
    0.2, $CellContext`viewAngle$$ = Rational[1, 4] Pi, Typeset`show$$ = True, 
    Typeset`bookmarkList$$ = {}, Typeset`bookmarkMode$$ = "Menu", 
    Typeset`animator$$, Typeset`animvar$$ = 1, Typeset`name$$ = 
    "\"untitled\"", Typeset`specs$$ = {{{
       Hold[$CellContext`lightCenter$$], {-1, 1}}, {-2, -2}, {2, 2}}, {{
       Hold[$CellContext`lightRadius$$], 2}, 1, 5}, {{
       Hold[$CellContext`roughness$$], 0.2}, 0.05, 1}, {{
       Hold[$CellContext`viewAngle$$], Rational[1, 4] Pi}, 0, Pi}}, 
    Typeset`size$$ = {360., {179., 185.}}, Typeset`update$$ = 0, 
    Typeset`initDone$$, Typeset`skipInitDone$$ = 
    True, $CellContext`lightCenter$21698$$ = {0, 
    0}, $CellContext`lightRadius$21699$$ = 0, $CellContext`roughness$21700$$ =
     0, $CellContext`viewAngle$21701$$ = 0}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`lightCenter$$ = {-1, 
         1}, $CellContext`lightRadius$$ = 2, $CellContext`roughness$$ = 
        0.2, $CellContext`viewAngle$$ = Rational[1, 4] Pi}, 
      "ControllerVariables" :> {
        Hold[$CellContext`lightCenter$$, $CellContext`lightCenter$21698$$, {0,
          0}], 
        Hold[$CellContext`lightRadius$$, $CellContext`lightRadius$21699$$, 0], 
        Hold[$CellContext`roughness$$, $CellContext`roughness$21700$$, 0], 
        Hold[$CellContext`viewAngle$$, $CellContext`viewAngle$21701$$, 0]}, 
      "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, "Body" :> gPlots`gParamPlot[
        Association[
         ("lines" -> {
           Association[
           "startPos" -> {0, 0}, "dirVec" -> FromPolarCoordinates[{1, 
               Slot["lineAngle"]}], "length" -> 2]}& )[
          Association["lineAngle" -> $CellContext`viewAngle$$]], 
         ("circles" -> {
           Association[
           "center" -> Slot["lightCenter"], "radius" -> 
            Slot["lightRadius"]]}& )[
          Association[
          "lightCenter" -> $CellContext`lightCenter$$, 
           "lightRadius" -> $CellContext`lightRadius$$]], 
         ("groundShadings" -> {
           Association[
           "lightCenter" -> Slot["lightCenter"], "lightRadius" -> 
            Slot["lightRadiusCtrl"], "roughness" -> Slot["roughness"], 
            "viewDir" -> FromPolarCoordinates[{1, 
               Slot["viewAngle"]}], 
            "shadingFunc" -> (Slot["nol"] gBRDF`gPointLightFallOff[
               Slot["lightRadius"], 
               Slot["shadingDist"]] gBRDF`gBrdfFunc[
               Slot["roughness"], 
               Slot["normalDir"], 
               Slot["lightDir"], 
               Slot["viewDir"]]& )]}& )[
          Association[
          "lightCenter" -> $CellContext`lightCenter$$, 
           "lightRadiusCtrl" -> $CellContext`lightRadius$$, 
           "roughness" -> $CellContext`roughness$$, 
           "viewAngle" -> $CellContext`viewAngle$$]], "axisExtent" -> 3], 
        Medium], 
      "Specifications" :> {{{$CellContext`lightCenter$$, {-1, 1}}, {-2, -2}, {
         2, 2}}, {{$CellContext`lightRadius$$, 2}, 1, 
         5}, {{$CellContext`roughness$$, 0.2}, 0.05, 
         1}, {{$CellContext`viewAngle$$, Rational[1, 4] Pi}, 0, Pi}}, 
      "Options" :> {Method -> {"ShowControls" -> True}}, 
      "DefaultOptions" :> {}],
     ImageSizeCache->{411., {296., 302.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UndoTrackedVariables:>{Typeset`show$$, Typeset`bookmarkMode$$},
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{
  3.831159131399238*^9, 3.831159327764292*^9, 3.8311595949599714`*^9, {
   3.8311597443645015`*^9, 3.8311597678080034`*^9}, 3.8311599510899987`*^9, 
   3.8311602798397307`*^9, {3.83116031710339*^9, 3.8311603241650968`*^9}, {
   3.8311604115733147`*^9, 3.8311604168824177`*^9}, {3.83116057822622*^9, 
   3.831160624710725*^9}, 3.83116241611049*^9, 3.831179270853613*^9, {
   3.831179459708642*^9, 3.8311794677406874`*^9}, 3.8311800816641655`*^9, 
   3.8311801220597467`*^9, {3.831181761499483*^9, 3.8311817680377393`*^9}, 
   3.8311826970159817`*^9, 3.8311842597160144`*^9, 3.831186525176833*^9, 
   3.8315317143380156`*^9, {3.831532407866885*^9, 3.8315324334725294`*^9}, {
   3.831532466167988*^9, 3.8315324788568425`*^9}, 3.8315325093220015`*^9, {
   3.831532565543601*^9, 3.8315325894337225`*^9}, {3.8315326446578074`*^9, 
   3.8315326727561827`*^9}, {3.831532719462315*^9, 3.831532827745146*^9}, {
   3.831532887009447*^9, 3.8315328969079103`*^9}, 3.8315329404160576`*^9, 
   3.8315329803267975`*^9, {3.8315330252098827`*^9, 3.8315330493493347`*^9}, {
   3.8315331083245506`*^9, 3.831533239843913*^9}, 3.8315335204089727`*^9, {
   3.8315335573322372`*^9, 3.8315336305361443`*^9}, 3.8315393107823195`*^9, 
   3.831540241792514*^9, 3.8315403238316236`*^9, {3.8315404854117913`*^9, 
   3.8315404967559557`*^9}, {3.831540529651494*^9, 3.8315405421651344`*^9}, {
   3.831540613791026*^9, 3.8315406474014187`*^9}, 3.8315408239021845`*^9, {
   3.831541046670722*^9, 3.83154108384131*^9}, 3.8315411280025835`*^9},
 CellLabel->"Out[94]=",ExpressionUUID->"fd3bee91-0c64-4839-aca3-6f3c30f7c670"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     SubscriptBox["f", "a"], "[", 
     RowBox[{"\[Lambda]_", ",", "\[Epsilon]_"}], "]"}], "=", 
    RowBox[{
     RowBox[{"-", "2"}], "\[Pi]", "*", 
     RowBox[{"Log", "[", 
      RowBox[{"\[Epsilon]", "/", "\[Lambda]"}], "]"}]}]}], ";"}], "//", 
  "N"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DefaultEpsilon", "=", "0.1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DefaultLightCenter", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "1"}], ",", "1"}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Fa", "[", "\[Lambda]_", "]"}], ":=", 
   RowBox[{
    SubscriptBox["f", "a"], "[", 
    RowBox[{"\[Lambda]", ",", "DefaultEpsilon"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"InvFa", "=", 
    RowBox[{"InverseFunction", "[", "Fa", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"sgDot", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"p1_", ",", "\[Lambda]1_", ",", "\[Mu]1_"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"p2_", ",", "\[Lambda]2_", ",", "\[Mu]2_"}], "}"}]}], "]"}], ":=", 
    RowBox[{"4", "\[Pi]", "*", "\[Mu]1", "*", "\[Mu]2", "*", 
     RowBox[{
      RowBox[{"Sinh", "[", 
       RowBox[{"Norm", "[", 
        RowBox[{
         RowBox[{"p1", "*", "\[Lambda]1"}], "+", 
         RowBox[{"p2", "*", "\[Lambda]2"}]}], "]"}], "]"}], "/", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Exp", "[", 
         RowBox[{"\[Lambda]1", "+", "\[Lambda]2"}], "]"}], "*", 
        RowBox[{"Norm", "[", 
         RowBox[{
          RowBox[{"p1", "*", "\[Lambda]1"}], "+", 
          RowBox[{"p2", "*", "\[Lambda]2"}]}], "]"}]}], ")"}]}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ApproxGGX", "[", 
    RowBox[{"m_", ",", "\[Theta]_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"(", 
     FractionBox["1", 
      RowBox[{"\[Pi]", 
       RowBox[{"(", 
        RowBox[{"m", "^", "2"}], ")"}]}]], ")"}], 
    RowBox[{"Exp", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"2", "/", 
        SuperscriptBox["m", "2"]}], ")"}], "*", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Cos", "[", "\[Theta]", "]"}], "-", "1"}], ")"}]}], "]"}]}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NDFConvolveLight", "[", 
    RowBox[{
    "xOffset_", ",", "roughness_", ",", "viewDir_", ",", "normalDir_", ",", 
     "lightPos_", ",", "lightRadius_", ",", "lightIntensity_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "d", ",", "shadingPos", ",", "lightDir", ",", "halfDir", ",", 
       "reflectDir", ",", "jacobian", ",", "p1", ",", "\[Lambda]1", ",", 
       "\[Mu]1", ",", "p2", ",", "\[Lambda]2", ",", "\[Mu]2"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"shadingPos", "=", 
       RowBox[{"{", 
        RowBox[{"xOffset", ",", "0"}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"d", "=", 
       RowBox[{"Norm", "[", 
        RowBox[{"lightPos", "-", "shadingPos"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"lightDir", "=", 
       RowBox[{"Normalize", "[", 
        RowBox[{"lightPos", "-", "shadingPos"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Point", " ", "Light", " ", "SG"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"p1", "=", "lightDir"}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Lambda]1", "=", 
       RowBox[{"InvFa", "[", 
        RowBox[{"2", "\[Pi]", "*", 
         RowBox[{
          SuperscriptBox["lightRadius", "2"], "/", 
          SuperscriptBox["d", "2"]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Mu]1", "=", 
       RowBox[{"lightIntensity", "/", 
        SuperscriptBox["d", "2"]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"NDF", " ", "SG"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"halfDir", "=", 
       RowBox[{"Normalize", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"lightDir", "+", "viewDir"}], ")"}], "/", "2"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"reflectDir", "=", 
       RowBox[{
        RowBox[{"2", 
         RowBox[{"Dot", "[", 
          RowBox[{"viewDir", ",", "normalDir"}], "]"}], "*", "normalDir"}], 
        "-", "viewDir"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"jacobian", "=", 
       RowBox[{"Max", "[", 
        RowBox[{
         RowBox[{"4", 
          RowBox[{"Dot", "[", 
           RowBox[{"halfDir", ",", "viewDir"}], "]"}]}], ",", "0.001"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"p2", "=", "reflectDir"}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Lambda]2", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"2", "/", 
          SuperscriptBox["roughness", "2"]}], ")"}], "/", "jacobian"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"\[Mu]2", "=", 
       RowBox[{"1", "/", 
        RowBox[{"(", 
         RowBox[{"\[Pi]", "*", 
          SuperscriptBox["roughness", "2"]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"d", "\[GreaterEqual]", "lightRadius"}], ",", "0", ",", 
        RowBox[{"sgDot", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"p1", ",", "\[Lambda]1", ",", "\[Mu]1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"p2", ",", "\[Lambda]2", ",", "\[Mu]2"}], "}"}]}], "]"}]}],
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ApproxLightPaint1", "[", 
     RowBox[{
     "xOffset_", ",", "roughness_", ",", "viewDir_", ",", "normalDir_", ",", 
      "lightPos_", ",", "lightRadius_", ",", "lightIntensity_"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", "sgShading", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"sgShading", "=", 
        RowBox[{"NDFConvolveLight", "[", 
         RowBox[{
         "xOffset", ",", "roughness", ",", "viewDir", ",", "normalDir", ",", 
          "lightPos", ",", "lightRadius", ",", "lightIntensity"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"xOffset", ",", "sgShading"}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DefaultViewDir", "=", 
   RowBox[{"Normalize", "[", 
    RowBox[{"{", 
     RowBox[{"1", ",", "1"}], "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DefaultNormalDir", "=", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DeaultLightIntensity", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Manipulate", "[", 
    RowBox[{
     RowBox[{"ParametricPlot", "[", 
      RowBox[{
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"CirclePaint", "[", 
          RowBox[{"DefaultLightCenter", ",", "radius", ",", "\[Theta]"}], 
          "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"ApproxLightPaint1", "[", 
          RowBox[{
          "\[Theta]", ",", "roughness", ",", "DefaultViewDir", ",", 
           "DefaultNormalDir", ",", "DefaultLightCenter", ",", "radius", ",", 
           "DeaultLightIntensity"}], "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"LinePaint", "[", 
          RowBox[{
           RowBox[{"0.5", "*", 
            RowBox[{"(", 
             RowBox[{"\[Theta]", "+", "\[Pi]"}], ")"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"\[Theta]", ",", 
         RowBox[{"-", "\[Pi]"}], ",", "\[Pi]"}], "}"}], ",", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"PlotStyle", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"Cyan", ",", "Green", ",", "Blue"}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "3"}], ",", "3"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "3"}], ",", "3"}], "}"}]}], "}"}]}], ",", 
       RowBox[{"AspectRatio", "\[Rule]", "1"}]}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"radius", ",", "2", ",", "5"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"roughness", ",", "0.05", ",", "0.9"}], "}"}]}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
  "gPrint", "[", "\"\<>Old Fit Convolve SG with NDF(Ground Lighting):\>\"", 
   "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Manipulate", "[", 
   RowBox[{
    RowBox[{"gParamPlot", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"<|", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"\"\<lines\>\"", "\[Rule]", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{"<|", 
             RowBox[{
              RowBox[{"\"\<startPos\>\"", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0"}], "}"}]}], ",", "\[IndentingNewLine]", 
              "\t", 
              RowBox[{"\"\<dirVec\>\"", "\[Rule]", 
               RowBox[{"FromPolarCoordinates", "[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "#lineAngle"}], "}"}], "]"}]}], ",", 
              RowBox[{"\"\<length\>\"", "\[Rule]", "2"}]}], "|>"}], 
            "\[IndentingNewLine]", "}"}]}], "&"}], "[", 
         RowBox[{"<|", 
          RowBox[{"\"\<lineAngle\>\"", "\[Rule]", "viewAngle"}], "|>"}], 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"\"\<circles\>\"", "\[Rule]", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{"<|", 
             RowBox[{
              RowBox[{"\"\<center\>\"", "\[Rule]", "#lightCenter"}], ",", 
              RowBox[{"\"\<radius\>\"", "\[Rule]", "#lightRadius"}]}], "|>"}],
             "\[IndentingNewLine]", "}"}]}], "&"}], "[", 
         RowBox[{"<|", 
          RowBox[{
           RowBox[{"\"\<lightCenter\>\"", "\[Rule]", "lightCenter"}], ",", 
           RowBox[{"\"\<lightRadius\>\"", "\[Rule]", "lightRadius"}]}], 
          "|>"}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"\"\<groundShadings\>\"", "\[Rule]", 
           RowBox[{"{", "\[IndentingNewLine]", "    ", 
            RowBox[{"<|", 
             RowBox[{
              RowBox[{"\"\<lightCenter\>\"", "\[Rule]", "#lightCenter"}], ",", 
              RowBox[{"\"\<lightRadius\>\"", "\[Rule]", "#lightRadiusCtrl"}], 
              ",", "\[IndentingNewLine]", "\t", 
              RowBox[{"\"\<roughness\>\"", "\[Rule]", "#roughness"}], ",", 
              RowBox[{"\"\<viewDir\>\"", "\[Rule]", 
               RowBox[{"FromPolarCoordinates", "[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "#viewAngle"}], "}"}], "]"}]}], ",", 
              "\[IndentingNewLine]", "\t", 
              RowBox[{"\"\<shadingFunc\>\"", "\[Rule]", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"#nol", "*", 
                  RowBox[{"gPointLightFallOff", "[", 
                   RowBox[{"#lightRadius", ",", "#shadingDist"}], "]"}], "*", 
                  "\[IndentingNewLine]", "\t\t\t\t ", 
                  RowBox[{"gBrdfFunc", "[", 
                   RowBox[{
                   "#roughness", ",", "#normalDir", ",", "#lightDir", ",", 
                    "#viewDir"}], "]"}]}], "&"}], ")"}]}]}], "|>"}], 
            "\[IndentingNewLine]", "}"}]}], "&"}], "[", 
         RowBox[{"<|", 
          RowBox[{
           RowBox[{"\"\<lightCenter\>\"", "\[Rule]", "lightCenter"}], ",", 
           RowBox[{"\"\<lightRadiusCtrl\>\"", "\[Rule]", "lightRadius"}], ",",
            "\[IndentingNewLine]", "\t\t", 
           RowBox[{"\"\<roughness\>\"", "\[Rule]", "roughness"}], ",", 
           RowBox[{"\"\<viewAngle\>\"", "\[Rule]", "viewAngle"}]}], "|>"}], 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<axisExtent\>\"", "\[Rule]", "3"}]}], 
       "\[IndentingNewLine]", "|>"}], ",", "Medium"}], "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"lightCenter", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "2"}], ",", 
        RowBox[{"-", "2"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2"}], "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"lightRadius", ",", "2"}], "}"}], ",", "1", ",", "5"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"roughness", ",", "0.2"}], "}"}], ",", "0.05", ",", "1"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"viewAngle", ",", 
        RowBox[{"\[Pi]", "/", "4"}]}], "}"}], ",", "0", ",", "\[Pi]"}], "}"}],
     ",", "\[IndentingNewLine]", 
    RowBox[{"Method", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"\"\<ShowControls\>\"", "\[Rule]", "True"}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.8311610894027767`*^9, 3.8311611544036455`*^9}, {
   3.8311612217631893`*^9, 3.831161246802561*^9}, {3.831161301003403*^9, 
   3.8311615006533375`*^9}, {3.831161570700322*^9, 3.831161594802808*^9}, {
   3.8311616953812346`*^9, 3.8311617190848975`*^9}, {3.83116181753197*^9, 
   3.8311618682429333`*^9}, {3.831162127234378*^9, 3.8311622816689987`*^9}, {
   3.831162317020039*^9, 3.831162335956648*^9}, {3.8311623672515287`*^9, 
   3.831162400581092*^9}, {3.8311624426353817`*^9, 3.8311626148132424`*^9}, {
   3.8311793149780755`*^9, 3.831179340552803*^9}, 3.831179476291432*^9, {
   3.8311795477062073`*^9, 3.8311795679777617`*^9}, {3.8311809229792013`*^9, 
   3.8311809229871793`*^9}, {3.831181624161186*^9, 3.8311816336028376`*^9}, {
   3.831541161950098*^9, 3.831541166008524*^9}, {3.831541301735651*^9, 
   3.831541314051265*^9}, 
   3.8315417353437915`*^9},ExpressionUUID->"830e4848-af02-4d1c-8e35-\
982b07bfd5a1"],

Cell[BoxData[
 StyleBox["\<\" >Old Fit Convolve SG with NDF(Ground Lighting):\"\>",
  StripOnInput->False,
  FontSize->18,
  Background->RGBColor[0.87, 0.94, 1]]], "Print",
 CellChangeTimes->{
  3.831162354769179*^9, {3.83116239642455*^9, 3.831162418934729*^9}, {
   3.831162599534092*^9, 3.831162616040056*^9}, 3.831179271330553*^9, 
   3.8311793171495023`*^9, {3.831179460176391*^9, 3.831179477173237*^9}, 
   3.831179568809108*^9, 3.8311801224801044`*^9, {3.8311816213617764`*^9, 
   3.8311816340756226`*^9}, 3.8311817993706408`*^9, 3.8311826974761577`*^9, 
   3.8311848590509768`*^9, 3.8311865303851557`*^9, 3.831531714520331*^9, 
   3.8315326449024887`*^9, {3.8315327677948985`*^9, 3.831532779875459*^9}, {
   3.831541146797742*^9, 3.831541167254053*^9}, 3.83154131487871*^9},
 FontSize->18,
 CellLabel->
  "During evaluation of \
In[150]:=",ExpressionUUID->"032f0aa2-f960-49de-833a-b298ef7b4378"],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`lightCenter$$ = {-1, 
    1}, $CellContext`lightRadius$$ = 2, $CellContext`roughness$$ = 
    0.2, $CellContext`viewAngle$$ = Rational[1, 4] Pi, Typeset`show$$ = True, 
    Typeset`bookmarkList$$ = {}, Typeset`bookmarkMode$$ = "Menu", 
    Typeset`animator$$, Typeset`animvar$$ = 1, Typeset`name$$ = 
    "\"untitled\"", Typeset`specs$$ = {{{
       Hold[$CellContext`lightCenter$$], {-1, 1}}, {-2, -2}, {2, 2}}, {{
       Hold[$CellContext`lightRadius$$], 2}, 1, 5}, {{
       Hold[$CellContext`roughness$$], 0.2}, 0.05, 1}, {{
       Hold[$CellContext`viewAngle$$], Rational[1, 4] Pi}, 0, Pi}}, 
    Typeset`size$$ = {360., {179., 185.}}, Typeset`update$$ = 0, 
    Typeset`initDone$$, Typeset`skipInitDone$$ = 
    True, $CellContext`lightCenter$25606$$ = {0, 
    0}, $CellContext`lightRadius$25607$$ = 0, $CellContext`roughness$25608$$ =
     0, $CellContext`viewAngle$25609$$ = 0}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`lightCenter$$ = {-1, 
         1}, $CellContext`lightRadius$$ = 2, $CellContext`roughness$$ = 
        0.2, $CellContext`viewAngle$$ = Rational[1, 4] Pi}, 
      "ControllerVariables" :> {
        Hold[$CellContext`lightCenter$$, $CellContext`lightCenter$25606$$, {0,
          0}], 
        Hold[$CellContext`lightRadius$$, $CellContext`lightRadius$25607$$, 0], 
        Hold[$CellContext`roughness$$, $CellContext`roughness$25608$$, 0], 
        Hold[$CellContext`viewAngle$$, $CellContext`viewAngle$25609$$, 0]}, 
      "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, "Body" :> gPlots`gParamPlot[
        Association[
         ("lines" -> {
           Association[
           "startPos" -> {0, 0}, "dirVec" -> FromPolarCoordinates[{1, 
               Slot["lineAngle"]}], "length" -> 2]}& )[
          Association["lineAngle" -> $CellContext`viewAngle$$]], 
         ("circles" -> {
           Association[
           "center" -> Slot["lightCenter"], "radius" -> 
            Slot["lightRadius"]]}& )[
          Association[
          "lightCenter" -> $CellContext`lightCenter$$, 
           "lightRadius" -> $CellContext`lightRadius$$]], 
         ("groundShadings" -> {
           Association[
           "lightCenter" -> Slot["lightCenter"], "lightRadius" -> 
            Slot["lightRadiusCtrl"], "roughness" -> Slot["roughness"], 
            "viewDir" -> FromPolarCoordinates[{1, 
               Slot["viewAngle"]}], 
            "shadingFunc" -> (Slot["nol"] gBRDF`gPointLightFallOff[
               Slot["lightRadius"], 
               Slot["shadingDist"]] gBRDF`gBrdfFunc[
               Slot["roughness"], 
               Slot["normalDir"], 
               Slot["lightDir"], 
               Slot["viewDir"]]& )]}& )[
          Association[
          "lightCenter" -> $CellContext`lightCenter$$, 
           "lightRadiusCtrl" -> $CellContext`lightRadius$$, 
           "roughness" -> $CellContext`roughness$$, 
           "viewAngle" -> $CellContext`viewAngle$$]], "axisExtent" -> 3], 
        Medium], 
      "Specifications" :> {{{$CellContext`lightCenter$$, {-1, 1}}, {-2, -2}, {
         2, 2}}, {{$CellContext`lightRadius$$, 2}, 1, 
         5}, {{$CellContext`roughness$$, 0.2}, 0.05, 
         1}, {{$CellContext`viewAngle$$, Rational[1, 4] Pi}, 0, Pi}}, 
      "Options" :> {Method -> {"ShowControls" -> True}}, 
      "DefaultOptions" :> {}],
     ImageSizeCache->{411., {296., 302.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UndoTrackedVariables:>{Typeset`show$$, Typeset`bookmarkMode$$},
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{
  3.8311623548290195`*^9, {3.831162396487378*^9, 3.8311624189317355`*^9}, {
   3.8311625995310993`*^9, 3.8311626160979023`*^9}, 3.831179271388398*^9, 
   3.8311793172073774`*^9, {3.8311794602481995`*^9, 3.831179477249035*^9}, 
   3.831179568877923*^9, 3.831180122548956*^9, {3.831181621435579*^9, 
   3.8311816341394515`*^9}, 3.8311817994364643`*^9, 3.831182697532007*^9, 
   3.8311848591048307`*^9, 3.8311865304210587`*^9, 3.831531714554264*^9, 
   3.831532644940522*^9, {3.831532767837756*^9, 3.8315327799179983`*^9}, {
   3.8315411468406982`*^9, 3.8315411673030715`*^9}, 3.831541314924038*^9},
 CellLabel->
  "Out[164]=",ExpressionUUID->"e0c34483-240c-424e-98d7-9dc262d45053"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"sgLightAmplitude", "[", 
    RowBox[{"t_", ",", "a_", ",", "b_", ",", "c_"}], "]"}], "=", 
   RowBox[{
    RowBox[{"a", "*", 
     RowBox[{"t", "^", "2"}]}], "+", 
    RowBox[{"b", "*", "t"}], "+", "c"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"sgLightSharpness", "[", 
    RowBox[{"percent_", ",", "d_", ",", "e_", ",", "f_"}], "]"}], "=", 
   RowBox[{
    RowBox[{"d", "*", 
     RowBox[{"percent", "^", "2"}]}], "+", 
    RowBox[{"e", "*", "percent"}], "+", "f"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DefaultLightCenter", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "1"}], ",", "1"}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RadiusParams", "=", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0.791375", ",", 
        RowBox[{"-", "1.89057"}], ",", "1.0872", ",", "6.66654", ",", 
        RowBox[{"-", "10.8249"}], ",", "6.76642"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "0.340146"}], ",", "0.0665636", ",", "0.236471", ",", 
        "3.79125", ",", "0.618155", ",", "1.38885"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"0.385139", ",", 
        RowBox[{"-", "0.87285"}], ",", "0.485253", ",", "1.80957", ",", 
        "0.308354", ",", "2.7173"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"0.213239", ",", 
        RowBox[{"-", "0.506706"}], ",", "0.291679", ",", "1.83615", ",", 
        "2.49729", ",", "1.51728"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"0.128335", ",", 
        RowBox[{"-", "0.316743"}], ",", "0.187358", ",", "2.15074", ",", 
        "3.59944", ",", "0.786432"}], "}"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"NDFConvolveLight2", "[", 
     RowBox[{
     "xOffset_", ",", "roughness_", ",", "viewDir_", ",", "normalDir_", ",", 
      "lightPos_", ",", "lightRadius_", ",", "lightIntensity_"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "d", ",", "shadingPos", ",", "distPercent", ",", "lightDir", ",", 
        "halfDir", ",", "reflectDir", ",", "jacobian", ",", "p1", ",", 
        "\[Lambda]1", ",", "\[Mu]1", ",", "p2", ",", "\[Lambda]2", ",", 
        "\[Mu]2"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"shadingPos", "=", 
        RowBox[{"{", 
         RowBox[{"xOffset", ",", "0"}], "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"d", "=", 
        RowBox[{"Norm", "[", 
         RowBox[{"lightPos", "-", "shadingPos"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"lightDir", "=", 
        RowBox[{"Normalize", "[", 
         RowBox[{"lightPos", "-", "shadingPos"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"distPercent", "=", 
        RowBox[{"d", "/", "lightRadius"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Point", " ", "Light", " ", "SG"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"p1", "=", "lightDir"}], ";", "\[IndentingNewLine]", 
       RowBox[{"\[Lambda]1", "=", 
        RowBox[{"sgLightSharpness", "[", 
         RowBox[{"distPercent", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"RadiusParams", "[", 
            RowBox[{"[", "lightRadius", "]"}], "]"}], "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"RadiusParams", "[", 
            RowBox[{"[", "lightRadius", "]"}], "]"}], "[", 
           RowBox[{"[", "5", "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"RadiusParams", "[", 
            RowBox[{"[", "lightRadius", "]"}], "]"}], "[", 
           RowBox[{"[", "6", "]"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Mu]1", "=", 
        RowBox[{"lightIntensity", "*", 
         RowBox[{"sgLightAmplitude", "[", 
          RowBox[{"distPercent", ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"RadiusParams", "[", 
             RowBox[{"[", "lightRadius", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{
            RowBox[{"RadiusParams", "[", 
             RowBox[{"[", "lightRadius", "]"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", 
           RowBox[{
            RowBox[{"RadiusParams", "[", 
             RowBox[{"[", "lightRadius", "]"}], "]"}], "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"NDF", " ", "SG"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"halfDir", "=", 
        RowBox[{"Normalize", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"lightDir", "+", "viewDir"}], ")"}], "/", "2"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"reflectDir", "=", 
        RowBox[{
         RowBox[{"2", 
          RowBox[{"Dot", "[", 
           RowBox[{"viewDir", ",", "normalDir"}], "]"}], "*", "normalDir"}], 
         "-", "viewDir"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"jacobian", "=", 
        RowBox[{"Max", "[", 
         RowBox[{
          RowBox[{"4", 
           RowBox[{"Dot", "[", 
            RowBox[{"halfDir", ",", "viewDir"}], "]"}]}], ",", "0.001"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"p2", "=", "reflectDir"}], ";", "\[IndentingNewLine]", 
       RowBox[{"\[Lambda]2", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"2", "/", 
           SuperscriptBox["roughness", "2"]}], ")"}], "/", "jacobian"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"\[Mu]2", "=", 
        RowBox[{"1", "/", 
         RowBox[{"(", 
          RowBox[{"\[Pi]", "*", 
           SuperscriptBox["roughness", "2"]}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"d", "\[GreaterEqual]", "lightRadius"}], ",", "0", ",", 
         RowBox[{"sgDot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"p1", ",", "\[Lambda]1", ",", "\[Mu]1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"p2", ",", "\[Lambda]2", ",", "\[Mu]2"}], "}"}]}], 
          "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ApproxLightPaint2", "[", 
     RowBox[{
     "xOffset_", ",", "roughness_", ",", "viewDir_", ",", "normalDir_", ",", 
      "lightPos_", ",", "lightRadius_", ",", "lightIntensity_"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"sgShading", ",", "lightDir", ",", "NoL"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"sgShading", "=", 
        RowBox[{"NDFConvolveLight2", "[", 
         RowBox[{
         "xOffset", ",", "roughness", ",", "viewDir", ",", "normalDir", ",", 
          "lightPos", ",", "lightRadius", ",", "lightIntensity"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"lightDir", "=", 
        RowBox[{"Normalize", "[", 
         RowBox[{"lightPos", "-", 
          RowBox[{"{", 
           RowBox[{"xOffset", ",", "0"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"NoL", "=", 
        RowBox[{"Dot", "[", 
         RowBox[{
          RowBox[{"Normalize", "[", "normalDir", "]"}], ",", "lightDir"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"xOffset", ",", 
         RowBox[{"NoL", "*", "sgShading"}]}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
  "Print", "[", 
   "\"\<>New Fit NDF Convolve Light(Ground Lighting). Green: SG Convolve. \
Blue: Origin NDF.\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Manipulate", "[", 
  RowBox[{
   RowBox[{"ParametricPlot", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"CirclePaint", "[", 
        RowBox[{"DefaultLightCenter", ",", "radius", ",", "\[Theta]"}], "]"}],
        ",", "\[IndentingNewLine]", 
       RowBox[{"ApproxLightPaint2", "[", 
        RowBox[{
        "\[Theta]", ",", "roughness", ",", "DefaultViewDir", ",", 
         "DefaultNormalDir", ",", "DefaultLightCenter", ",", "radius", ",", 
         "DeaultLightIntensity"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"NoLFallBrdfPaint", "[", 
        RowBox[{"\[Theta]", ",", "radius", ",", "roughness"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"LinePaint", "[", 
        RowBox[{
         RowBox[{"0.5", "*", 
          RowBox[{"(", 
           RowBox[{"\[Theta]", "+", "\[Pi]"}], ")"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"\[Theta]", ",", 
       RowBox[{"-", "\[Pi]"}], ",", "\[Pi]"}], "}"}], ",", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"PlotStyle", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"Cyan", ",", "Green", ",", "Blue", ",", "Blue"}], "}"}]}], ",",
      "\[IndentingNewLine]", 
     RowBox[{"PlotRange", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "3"}], ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "3"}], ",", "3"}], "}"}]}], "}"}]}], ",", 
     RowBox[{"AspectRatio", "\[Rule]", "1"}]}], "]"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{"radius", ",", "2", ",", "5", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"roughness", ",", "0.05", ",", "0.9"}], "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8311793342496266`*^9, 3.8311793992327814`*^9}, {
   3.8311796618880243`*^9, 3.83117980720912*^9}, {3.8311798650449295`*^9, 
   3.831179895392618*^9}, {3.831179972985995*^9, 3.8311799903850174`*^9}, {
   3.8311801417629137`*^9, 3.8311801476017065`*^9}, {3.831180221097597*^9, 
   3.831180308289706*^9}, {3.8311804006265774`*^9, 3.8311804161352797`*^9}, {
   3.8311809229941597`*^9, 3.8311809230021687`*^9}, {3.831181374319137*^9, 
   3.831181374607366*^9}, {3.8311815416966276`*^9, 3.831181589033921*^9}, {
   3.831182723638428*^9, 3.8311827388815665`*^9}, {3.8311827812146645`*^9, 
   3.8311828241752033`*^9}, 3.8315411820218067`*^9},
 CellLabel->
  "In[135]:=",ExpressionUUID->"1f0a120a-54d5-4471-b56b-e57efbcdea45"],

Cell[BoxData["\<\">New Fit NDF Convolve Light(Ground Lighting). Green: SG \
Convolve. Blue: Origin NDF.\"\>"], "Print",
 CellChangeTimes->{{3.831179352302804*^9, 3.8311793999484196`*^9}, 
   3.8311794604672527`*^9, 3.831179608622902*^9, 3.831179671382259*^9, 
   3.8311798157792215`*^9, 3.8311798998611326`*^9, {3.8311799870600615`*^9, 
   3.8311799912039547`*^9}, {3.83118009958366*^9, 3.8311801481219645`*^9}, 
   3.831180309307458*^9, 3.8311804170847545`*^9, 3.8311813750577765`*^9, {
   3.8311815435594397`*^9, 3.831181590045087*^9}, 3.831182697673644*^9, {
   3.8311828150227947`*^9, 3.831182825031316*^9}, 3.83118486418917*^9, 
   3.8311867305410285`*^9, 3.8315317146558247`*^9, 3.8315326450458007`*^9, {
   3.8315327679494867`*^9, 3.831532780023429*^9}, 3.831541182849799*^9},
 FontSize->18,
 CellLabel->
  "During evaluation of \
In[135]:=",ExpressionUUID->"3bbe59b8-46ee-46c3-a037-259d777b2f9e"],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`radius$$ = 2, $CellContext`roughness$$ = 
    0.05, Typeset`show$$ = True, Typeset`bookmarkList$$ = {}, 
    Typeset`bookmarkMode$$ = "Menu", Typeset`animator$$, Typeset`animvar$$ = 
    1, Typeset`name$$ = "\"untitled\"", Typeset`specs$$ = {{
      Hold[$CellContext`radius$$], 2, 5, 1}, {
      Hold[$CellContext`roughness$$], 0.05, 0.9}}, Typeset`size$$ = {
    360., {179., 185.}}, Typeset`update$$ = 0, Typeset`initDone$$, 
    Typeset`skipInitDone$$ = True, $CellContext`radius$24086$$ = 
    0, $CellContext`roughness$24087$$ = 0}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`radius$$ = 2, $CellContext`roughness$$ = 
        0.05}, "ControllerVariables" :> {
        Hold[$CellContext`radius$$, $CellContext`radius$24086$$, 0], 
        Hold[$CellContext`roughness$$, $CellContext`roughness$24087$$, 0]}, 
      "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, "Body" :> ParametricPlot[{
         $CellContext`CirclePaint[$CellContext`DefaultLightCenter, \
$CellContext`radius$$, $CellContext`\[Theta]], 
         $CellContext`ApproxLightPaint2[$CellContext`\[Theta], \
$CellContext`roughness$$, $CellContext`DefaultViewDir, \
$CellContext`DefaultNormalDir, $CellContext`DefaultLightCenter, \
$CellContext`radius$$, $CellContext`DeaultLightIntensity], 
         $CellContext`NoLFallBrdfPaint[$CellContext`\[Theta], \
$CellContext`radius$$, $CellContext`roughness$$], 
         $CellContext`LinePaint[
         0.5 ($CellContext`\[Theta] + Pi), {0, 0}, {1, 
          1}]}, {$CellContext`\[Theta], -Pi, Pi}, 
        PlotStyle -> {Cyan, Green, Blue, Blue}, 
        PlotRange -> {{-3, 3}, {-3, 3}}, AspectRatio -> 1], 
      "Specifications" :> {{$CellContext`radius$$, 2, 5, 
         1}, {$CellContext`roughness$$, 0.05, 0.9}}, "Options" :> {}, 
      "DefaultOptions" :> {}],
     ImageSizeCache->{411., {240., 246.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UndoTrackedVariables:>{Typeset`show$$, Typeset`bookmarkMode$$},
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{{3.831179381497628*^9, 3.8311794000102863`*^9}, 
   3.831179460527093*^9, 3.8311796086867313`*^9, 3.831179671441104*^9, 
   3.831179815838064*^9, 3.831179899922967*^9, {3.831179987122893*^9, 
   3.831179991267788*^9}, {3.83118009964412*^9, 3.831180148187297*^9}, 
   3.8311803093842535`*^9, 3.8311804171485834`*^9, 3.831181375120609*^9, {
   3.831181543621275*^9, 3.831181590106926*^9}, 3.831182697720519*^9, {
   3.831182815066677*^9, 3.8311828250811825`*^9}, 3.831184864247015*^9, 
   3.831186730588005*^9, 3.831531714682678*^9, 3.8315326450777316`*^9, {
   3.8315327679793777`*^9, 3.8315327800542936`*^9}, 3.8315411828977566`*^9},
 CellLabel->
  "Out[142]=",ExpressionUUID->"4b89ee85-53ec-4f17-a70d-ded57bb33f2e"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"sgLightPaint3", "[", 
     RowBox[{
     "xOffset_", ",", "roughness_", ",", "viewDir_", ",", "normalDir_", ",", 
      "lightPos_", ",", "lightRadius_", ",", "lightIntensity_"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"sgShading", ",", "lightDir", ",", "NoL"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"sgShading", "=", 
        RowBox[{"NDFConvolveLight2", "[", 
         RowBox[{
         "xOffset", ",", "roughness", ",", "viewDir", ",", "normalDir", ",", 
          "lightPos", ",", "lightRadius", ",", "lightIntensity"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"lightDir", "=", 
        RowBox[{"Normalize", "[", 
         RowBox[{"lightPos", "-", 
          RowBox[{"{", 
           RowBox[{"xOffset", ",", "0"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"NoL", "=", 
        RowBox[{"Dot", "[", 
         RowBox[{
          RowBox[{"Normalize", "[", "normalDir", "]"}], ",", "lightDir"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"xOffset", ",", 
         RowBox[{"NoL", "*", "sgShading"}]}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DefaultLightCenter", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "1"}], ",", "1"}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Manipulate", "[", 
  RowBox[{
   RowBox[{"ParametricPlot", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"CirclePaint", "[", 
        RowBox[{"DefaultLightCenter", ",", "radius", ",", "\[Theta]"}], "]"}],
        ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"LinePaint", "[", 
        RowBox[{
         RowBox[{"0.5", "*", 
          RowBox[{"(", 
           RowBox[{"\[Theta]", "+", "\[Pi]"}], ")"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"\[Theta]", ",", 
       RowBox[{"-", "\[Pi]"}], ",", "\[Pi]"}], "}"}], ",", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"PlotStyle", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"Cyan", ",", "Green", ",", "Blue", ",", "Blue"}], "}"}]}], ",",
      "\[IndentingNewLine]", 
     RowBox[{"PlotRange", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "3"}], ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "3"}], ",", "3"}], "}"}]}], "}"}]}], ",", 
     RowBox[{"AspectRatio", "\[Rule]", "1"}]}], "]"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{"radius", ",", "2", ",", "5", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"roughness", ",", "0.05", ",", "0.9"}], "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.831187649435877*^9, 3.8311876643556194`*^9}, {
   3.83118777970713*^9, 3.831187833122547*^9}, 3.8315411903488207`*^9},
 CellLabel->
  "In[143]:=",ExpressionUUID->"4c6d4c30-4b35-478e-b085-c79a6aec9eee"],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`radius$$ = 2, $CellContext`roughness$$ = 
    0.05, Typeset`show$$ = True, Typeset`bookmarkList$$ = {}, 
    Typeset`bookmarkMode$$ = "Menu", Typeset`animator$$, Typeset`animvar$$ = 
    1, Typeset`name$$ = "\"untitled\"", Typeset`specs$$ = {{
      Hold[$CellContext`radius$$], 2, 5, 1}, {
      Hold[$CellContext`roughness$$], 0.05, 0.9}}, Typeset`size$$ = {
    360., {179., 185.}}, Typeset`update$$ = 0, Typeset`initDone$$, 
    Typeset`skipInitDone$$ = True, $CellContext`radius$25469$$ = 
    0, $CellContext`roughness$25470$$ = 0}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`radius$$ = 2, $CellContext`roughness$$ = 
        0.05}, "ControllerVariables" :> {
        Hold[$CellContext`radius$$, $CellContext`radius$25469$$, 0], 
        Hold[$CellContext`roughness$$, $CellContext`roughness$25470$$, 0]}, 
      "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, "Body" :> ParametricPlot[{
         $CellContext`CirclePaint[$CellContext`DefaultLightCenter, \
$CellContext`radius$$, $CellContext`\[Theta]], 
         $CellContext`LinePaint[
         0.5 ($CellContext`\[Theta] + Pi), {0, 0}, {1, 
          1}]}, {$CellContext`\[Theta], -Pi, Pi}, 
        PlotStyle -> {Cyan, Green, Blue, Blue}, 
        PlotRange -> {{-3, 3}, {-3, 3}}, AspectRatio -> 1], 
      "Specifications" :> {{$CellContext`radius$$, 2, 5, 
         1}, {$CellContext`roughness$$, 0.05, 0.9}}, "Options" :> {}, 
      "DefaultOptions" :> {}],
     ImageSizeCache->{411., {240., 246.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UndoTrackedVariables:>{Typeset`show$$, Typeset`bookmarkMode$$},
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{
  3.8311876522600946`*^9, 3.8311877665391097`*^9, 3.831531714839393*^9, 
   3.8315326452282467`*^9, {3.8315327681519175`*^9, 3.8315327802086487`*^9}, 
   3.831541191705982*^9},
 CellLabel->
  "Out[145]=",ExpressionUUID->"4df518ce-74b3-4aa6-be27-434fbcf066d9"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"VisSmithApprox", "[", 
     RowBox[{"m_", ",", "NoL_", ",", "NoV_"}], "]"}], ":=", 
    FractionBox["0.5", 
     RowBox[{
      RowBox[{"VisSmithApproxG", "[", 
       RowBox[{"m", ",", "NoL", ",", "NoV"}], "]"}], "+", 
      RowBox[{"VisSmithApproxG", "[", 
       RowBox[{"m", ",", "NoV", ",", "NoL"}], "]"}]}]]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FresnelOriginN", "[", "SpecularColor_", "]"}], ":=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"1", "+", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"Max", "[", 
        RowBox[{"SpecularColor", ",", "0.99"}], "]"}], "]"}]}], ")"}], "/", 
    RowBox[{"(", 
     RowBox[{"1", "-", 
      RowBox[{"Max", "[", 
       RowBox[{"SpecularColor", ",", "0.99"}], "]"}]}], ")"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FresnelOriginG", "[", 
    RowBox[{"VoH_", ",", "SpecularColor_"}], "]"}], ":=", 
   RowBox[{"Sqrt", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"FresnelOriginN", "[", "SpecularColor", "]"}], "^", "2"}], "+", 
     RowBox[{"VoH", "^", "2"}], "-", "1"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FresnelOrigin", "[", 
     RowBox[{"VoH_", ",", "SpecularColor_"}], "]"}], ":=", 
    RowBox[{"0.5", "*", 
     SuperscriptBox[
      RowBox[{"(", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"FresnelOriginG", "[", 
           RowBox[{"VoH", ",", "SpecularColor"}], "]"}], "-", "VoH"}], ")"}], 
        "/", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"FresnelOriginG", "[", 
           RowBox[{"VoH", ",", "SpecularColor"}], "]"}], "+", "VoH"}], 
         ")"}]}], ")"}], "2"], "*", 
     RowBox[{"(", 
      RowBox[{"1", "+", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"FresnelOriginG", "[", 
                RowBox[{"VoH", ",", "SpecularColor"}], "]"}], "+", "VoH"}], 
              ")"}], "*", "VoH"}], "-", "1"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"FresnelOriginG", "[", 
                RowBox[{"VoH", ",", "SpecularColor"}], "]"}], "-", "VoH"}], 
              ")"}], "*", "VoH"}], "+", "1"}], ")"}]}], ")"}], "2"]}], 
      ")"}]}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ApproxLightPaint6", "[", 
     RowBox[{
     "xOffset_", ",", "roughness_", ",", "viewDir_", ",", "normalDir_", ",", 
      "lightPos_", ",", "lightRadius_", ",", "lightIntensity_"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"sgShading", ",", "V", ",", "F", ",", "NoL"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"sgShading", "=", 
        RowBox[{"NDFConvolveLight", "[", 
         RowBox[{
         "xOffset", ",", "roughness", ",", "viewDir", ",", "normalDir", ",", 
          "lightPos", ",", "lightRadius", ",", "lightIntensity"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"NoL", "="}], ";", "\[IndentingNewLine]", 
       RowBox[{"V", "=", 
        RowBox[{"VisSmithApprox", "[", 
         RowBox[{"roughness", ","}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"F", "="}], ";", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"xOffset", ",", 
         RowBox[{"sgShading", "*", "V", "*", "F", "*", "NoL"}]}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"\"\<>Specular Lighting:\>\"", " ", 
    RowBox[{"TraditionalForm", "[", 
     RowBox[{
      RowBox[{"(", "NoL", ")"}], "*", 
      RowBox[{"(", "V", ")"}], "*", 
      RowBox[{"(", "F", ")"}], "*", 
      RowBox[{"Convolve", "[", 
       RowBox[{
        SubscriptBox["SG", "light"], ",", 
        SubscriptBox["SG", "ndf"], ",", "p1", ",", "p2"}], "]"}]}], "]"}]}], 
   "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Manipulate", "[", 
  RowBox[{
   RowBox[{"ParametricPlot", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"CirclePaint", "[", 
        RowBox[{"DefaultLightCenter", ",", "radius", ",", "\[Theta]"}], "]"}],
        ",", "\[IndentingNewLine]", 
       RowBox[{"ApproxLightPaint6", "[", 
        RowBox[{
        "\[Theta]", ",", "roughness", ",", "DefaultViewDir", ",", 
         "DefaultNormalDir", ",", "DefaultLightCenter", ",", "radius", ",", 
         "DeaultLightIntensity"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"LinePaint", "[", 
        RowBox[{
         RowBox[{"0.5", "*", 
          RowBox[{"(", 
           RowBox[{"\[Theta]", "+", "\[Pi]"}], ")"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"\[Theta]", ",", 
       RowBox[{"-", "\[Pi]"}], ",", "\[Pi]"}], "}"}], ",", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"PlotStyle", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"Cyan", ",", "Green", ",", "Blue"}], "}"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"PlotRange", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "3"}], ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "3"}], ",", "3"}], "}"}]}], "}"}]}], ",", 
     RowBox[{"AspectRatio", "\[Rule]", "1"}]}], "]"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{"radius", ",", "2", ",", "5"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"roughness", ",", "0.2", ",", "0.9"}], "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.831162904245553*^9, 3.8311629210335217`*^9}, {
  3.8311629807080536`*^9, 3.8311630609933524`*^9}, {3.8311630996994085`*^9, 
  3.831163219562481*^9}, {3.831179330569951*^9, 3.831179332120524*^9}, {
  3.8311808969545364`*^9, 3.8311809356723547`*^9}, {3.8311876776353664`*^9, 
  3.8311876795305166`*^9}},
 EmphasizeSyntaxErrors->True,
 CellLabel->
  "In[146]:=",ExpressionUUID->"f853c461-1537-49b7-bc88-32b56bcb17ab"]
},
WindowSize->{967, 763},
WindowMargins->{{66, Automatic}, {-43, Automatic}},
FrontEndVersion->"12.0 for Microsoft Windows (64-bit) (April 8, 2019)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 6887, 151, 580, "Input",ExpressionUUID->"a553c2d9-ec9e-417a-9b05-f7e73d693e26"],
Cell[7470, 175, 1760, 29, 30, "Print",ExpressionUUID->"182334f4-619e-47e8-aa7c-1982701672ba"],
Cell[9233, 206, 5681, 104, 617, "Output",ExpressionUUID->"fd3bee91-0c64-4839-aca3-6f3c30f7c670"]
}, Open  ]],
Cell[CellGroupData[{
Cell[14951, 315, 14704, 371, 1424, "Input",ExpressionUUID->"830e4848-af02-4d1c-8e35-982b07bfd5a1"],
Cell[29658, 688, 902, 17, 30, "Print",ExpressionUUID->"032f0aa2-f960-49de-833a-b298ef7b4378"],
Cell[30563, 707, 4773, 93, 617, "Output",ExpressionUUID->"e0c34483-240c-424e-98d7-9dc262d45053"]
}, Open  ]],
Cell[CellGroupData[{
Cell[35373, 805, 10806, 263, 1036, "Input",ExpressionUUID->"1f0a120a-54d5-4471-b56b-e57efbcdea45"],
Cell[46182, 1070, 904, 14, 30, "Print",ExpressionUUID->"3bbe59b8-46ee-46c3-a037-259d777b2f9e"],
Cell[47089, 1086, 3299, 60, 505, "Output",ExpressionUUID->"4b89ee85-53ec-4f17-a70d-ded57bb33f2e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[50425, 1151, 3349, 88, 371, "Input",ExpressionUUID->"4c6d4c30-4b35-478e-b085-c79a6aec9eee"],
Cell[53777, 1241, 2480, 49, 505, "Output",ExpressionUUID->"4df518ce-74b3-4aa6-be27-434fbcf066d9"]
}, Open  ]],
Cell[56272, 1293, 6448, 174, 532, "Input",ExpressionUUID->"f853c461-1537-49b7-bc88-32b56bcb17ab"]
}
]
*)

