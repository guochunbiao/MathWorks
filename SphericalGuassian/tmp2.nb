(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     28973,        623]
NotebookOptionsPosition[     28318,        603]
NotebookOutlinePosition[     28663,        618]
CellTagsIndexPosition[     28620,        615]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<gUtils`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<gBRDF`\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<sgCommon`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<gPlots`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<gPlots3D`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Needs", "[", "\"\<gSphericalCap`\>\"", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAll", "[", 
   RowBox[{
   "oldLightSg2D", ",", "oldLightSg3D", ",", "newLightSg3D", ",", 
    "newLightSg2D", ",", "bentCone", ",", "\[IndentingNewLine]", "\t", 
    "coneTheta2D", ",", "coneAperture", ",", "coneCapAxis", ",", "coneCap", 
    ",", "energyPercent"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Manipulate", "[", "\[IndentingNewLine]", "\t", 
  RowBox[{
   RowBox[{
    RowBox[{"oldLightSg2D", "=", 
     RowBox[{
      RowBox[{"sgSphereLight", "[", 
       RowBox[{
       "lightCenter", ",", "lightFadeStart", ",", "lightFadeEnd", ",", 
        "lightIntensity", ",", 
        RowBox[{"{", 
         RowBox[{"shadingPosX", ",", "0"}], "}"}]}], "]"}], "//", "N"}]}], 
    ";", "\[IndentingNewLine]", "\t", 
    RowBox[{"oldLightSg3D", "=", 
     RowBox[{"sgTo3D", "[", "oldLightSg2D", "]"}]}], ";", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"bentCone", "=", 
     RowBox[{
      RowBox[{"gCreateCone", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"shadingPosX", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "2"}], ",", "leftWallHeight"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "rightWallHeight"}], "}"}]}], "]"}], "//", "N"}]}],
     ";", "\[IndentingNewLine]", "\t", 
    RowBox[{"coneTheta2D", "=", 
     RowBox[{
      RowBox[{"bentCone", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "//", "N"}]}], ";", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"coneAperture", "=", 
     RowBox[{
      RowBox[{"bentCone", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "//", "N"}]}], ";", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"coneCapAxis", "=", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Cos", "[", "coneTheta2D", "]"}], ",", "0", ",", 
        RowBox[{"Sin", "[", "coneTheta2D", "]"}]}], "}"}], "//", "N"}]}], ";",
     "\[IndentingNewLine]", "\t", 
    RowBox[{"coneCap", "=", 
     RowBox[{"{", 
      RowBox[{"coneCapAxis", ",", "coneAperture"}], "}"}]}], ";", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"newLightSg3D", "=", 
       RowBox[{
        RowBox[{"Quiet", "@", 
         RowBox[{"sgCapIntsAsNewSG", "[", 
          RowBox[{"oldLightSg3D", ",", "coneCap"}], "]"}]}], "//", "N"}]}], 
      ";", "\[IndentingNewLine]", "\t", 
      RowBox[{"newLightSg2D", "=", 
       RowBox[{"sgTo2D", "[", "newLightSg3D", "]"}]}], ";"}], "*)"}], 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"energyPercent", "=", 
     RowBox[{"N", "@", 
      RowBox[{"sgCapIntsEnergyPercent", "[", 
       RowBox[{"oldLightSg3D", ",", "coneCap"}], "]"}]}]}], ";", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"newLightSg2D", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"oldLightSg2D", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{"oldLightSg2D", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{"energyPercent", "*", 
        RowBox[{"oldLightSg2D", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", " ", 
    RowBox[{"gParamPlot", "[", "\[IndentingNewLine]", 
     RowBox[{"<|", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"\"\<circles\>\"", "\[Rule]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "inner", " ", "circle", " ", "of", " ", "sphere", " ", "light"}], 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"<|", 
            RowBox[{
             RowBox[{"\"\<center\>\"", "\[Rule]", "#lightCenter"}], ",", 
             RowBox[{"\"\<radius\>\"", "\[Rule]", "#lightFadeStart"}]}], 
            "|>"}], "\[IndentingNewLine]", "}"}]}], "&"}], "[", 
        RowBox[{"<|", 
         RowBox[{
          RowBox[{"\"\<lightCenter\>\"", "\[Rule]", "lightCenter"}], ",", 
          RowBox[{"\"\<lightFadeStart\>\"", "\[Rule]", "lightFadeStart"}]}], 
         "|>"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"\"\<lines\>\"", "\[Rule]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{"(*", "ground", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"<|", 
             RowBox[{
              RowBox[{"\"\<startPos\>\"", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "2"}], ",", "0"}], "}"}]}], ",", 
              RowBox[{"\"\<dirVec\>\"", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"1", ",", "0"}], "}"}]}], ",", 
              RowBox[{"\"\<length\>\"", "\[Rule]", "4"}], ",", 
              "\[IndentingNewLine]", "\t", 
              RowBox[{"\"\<color\>\"", "\[Rule]", "Green"}], ",", 
              RowBox[{"\"\<thickness\>\"", "\[Rule]", "0.015"}]}], "|>"}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"left", " ", "wall"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"<|", 
             RowBox[{
              RowBox[{"\"\<startPos\>\"", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "2"}], ",", "0"}], "}"}]}], ",", 
              RowBox[{"\"\<dirVec\>\"", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"0", ",", "1"}], "}"}]}], ",", 
              RowBox[{"\"\<length\>\"", "\[Rule]", "#leftWallHeight"}], ",", 
              "\[IndentingNewLine]", "\t", 
              RowBox[{"\"\<color\>\"", "\[Rule]", "Green"}], ",", 
              RowBox[{"\"\<thickness\>\"", "\[Rule]", "0.015"}]}], "|>"}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"right", " ", "wall"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"<|", 
             RowBox[{
              RowBox[{"\"\<startPos\>\"", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"2", ",", "0"}], "}"}]}], ",", "\[IndentingNewLine]", 
              "\t", 
              RowBox[{"\"\<dirVec\>\"", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"0", ",", "1"}], "}"}]}], ",", 
              RowBox[{"\"\<length\>\"", "\[Rule]", "#rightWallHeight"}], ",", 
              "\[IndentingNewLine]", "\t", 
              RowBox[{"\"\<color\>\"", "\[Rule]", "Green"}], ",", 
              RowBox[{"\"\<thickness\>\"", "\[Rule]", "0.015"}]}], "|>"}]}], 
           "\[IndentingNewLine]", "}"}]}], "&"}], "[", 
        RowBox[{"<|", 
         RowBox[{
          RowBox[{"\"\<leftWallHeight\>\"", "\[Rule]", "leftWallHeight"}], 
          ",", 
          RowBox[{"\"\<rightWallHeight\>\"", "\[Rule]", "rightWallHeight"}]}],
          "|>"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"\"\<sgGroundShadingWithWalls\>\"", "\[Rule]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{"<|", 
            RowBox[{
             RowBox[{"\"\<lightCenter\>\"", "\[Rule]", "#lightCenter"}], ",", 
             "\[IndentingNewLine]", "\t", 
             RowBox[{"\"\<lightFadeStart\>\"", "\[Rule]", "#lightFadeStart"}],
              ",", "\[IndentingNewLine]", "\t", 
             RowBox[{"\"\<lightFadeEnd\>\"", "\[Rule]", "#lightFadeEnd"}], 
             ",", "\[IndentingNewLine]", "\t", 
             RowBox[{"\"\<wallXRange\>\"", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "2"}], ",", "2"}], "}"}]}], ",", 
             "\[IndentingNewLine]", "\t", 
             RowBox[{"\"\<wallHeights\>\"", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"#leftWallHeight", ",", "#rightWallHeight"}], "}"}]}], 
             ",", "\[IndentingNewLine]", "\t", 
             RowBox[{
             "\"\<lightIntensity\>\"", "\[Rule]", "#lightIntensityCtrl"}], 
             ",", 
             RowBox[{"\"\<roughness\>\"", "\[Rule]", "#roughness"}], ",", 
             "\[IndentingNewLine]", "\t", 
             RowBox[{"\"\<viewDir\>\"", "\[Rule]", 
              RowBox[{"FromPolarCoordinates", "[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "#viewAngle"}], "}"}], "]"}]}], ",", 
             "\[IndentingNewLine]", "\t", 
             RowBox[{"\"\<sgLightFunc\>\"", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"sgSphereLight", "[", 
                 RowBox[{
                 "#lightCenter", ",", "#lightFadeStart", ",", "#lightFadeEnd",
                   ",", "\[IndentingNewLine]", "\t\t", "#lightIntensity", ",",
                   "#shadingPos"}], "]"}], "&"}], ")"}]}], ",", 
             "\[IndentingNewLine]", "\t", 
             RowBox[{"\"\<sgNDFFunc\>\"", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"sgNDF", "[", 
                 RowBox[{
                 "#roughness", ",", "#lightDir", ",", "#viewDir", ",", 
                  "#normalDir"}], "]"}], "&"}], ")"}]}], ",", 
             "\[IndentingNewLine]", "\t", 
             RowBox[{"\"\<sgShadingFunc\>\"", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"1", "&"}], ")"}]}], ",", "\[IndentingNewLine]", "\t", 
             RowBox[{"\"\<bApplyEnergyPercent\>\"", "\[Rule]", "True"}], ",", 
             "\[IndentingNewLine]", "\t", 
             RowBox[{"\"\<color\>\"", "\[Rule]", "Blue"}], ",", 
             "\[IndentingNewLine]", "\t", 
             RowBox[{
             "\"\<label\>\"", "\[Rule]", "\"\<Energy Percent Only\>\""}]}], 
            "|>"}], "\[IndentingNewLine]", "}"}]}], "&"}], "[", 
        RowBox[{"<|", 
         RowBox[{
          RowBox[{"\"\<lightCenter\>\"", "\[Rule]", "lightCenter"}], ",", 
          "\[IndentingNewLine]", "\t\t", 
          RowBox[{"\"\<lightFadeStart\>\"", "\[Rule]", "lightFadeStart"}], 
          ",", 
          RowBox[{"\"\<lightFadeEnd\>\"", "\[Rule]", "lightFadeEnd"}], ",", 
          "\[IndentingNewLine]", "\t\t", 
          RowBox[{"\"\<lightIntensityCtrl\>\"", "\[Rule]", "lightIntensity"}],
           ",", 
          RowBox[{"\"\<viewAngle\>\"", "\[Rule]", "viewAngle"}], ",", 
          "\[IndentingNewLine]", "\t\t", 
          RowBox[{"\"\<leftWallHeight\>\"", "\[Rule]", "leftWallHeight"}], 
          ",", 
          RowBox[{"\"\<rightWallHeight\>\"", "\[Rule]", "rightWallHeight"}], 
          ",", "\t\t", "\[IndentingNewLine]", "\t\t", 
          RowBox[{"\"\<roughness\>\"", "\[Rule]", "roughness"}]}], "|>"}], 
        "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"\"\<axisExtent\>\"", "\[Rule]", "5"}]}], 
      "\[IndentingNewLine]", "|>"}], "]"}]}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"lightCenter", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "2.5"}], ",", "1.5"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "4"}], ",", 
       RowBox[{"-", "4"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"4", ",", "4"}], "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"lightFadeStart", ",", "3"}], "}"}], ",", "1", ",", "3"}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"lightFadeEnd", ",", "5"}], "}"}], ",", "3", ",", "20"}], "}"}],
    ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"lightIntensity", ",", "1"}], "}"}], ",", "1", ",", "10"}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"leftWallHeight", ",", "1"}], "}"}], ",", "0", ",", "2"}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"rightWallHeight", ",", "1"}], "}"}], ",", "0", ",", "2"}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"viewAngle", ",", 
       RowBox[{"\[Pi]", "/", "4"}]}], "}"}], ",", "0", ",", "\[Pi]"}], "}"}], 
   ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{"newEnergyPercent", ",", "energyPercent"}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"roughness", ",", "0.1"}], "}"}], ",", "0.05", ",", "1"}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"shadingPosX", ",", 
       RowBox[{"-", "1"}]}], "}"}], ",", 
     RowBox[{"-", "2"}], ",", "2"}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Method", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"\"\<ShowControls\>\"", "\[Rule]", "False"}], "}"}]}]}], 
  "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAll", "[", 
   RowBox[{
   "oldLightSg2D", ",", "oldLightSg3D", ",", "newLightSg3D", ",", 
    "newLightSg2D", ",", "bentCone", ",", "\[IndentingNewLine]", "\t", 
    "coneTheta2D", ",", "coneAperture", ",", "coneCapAxis", ",", "coneCap", 
    ",", "energyPercent"}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.8328889412895775`*^9, 3.832888943829444*^9}, 
   3.8329105814363804`*^9, 3.832911658214327*^9, {3.832915422319006*^9, 
   3.832915429550082*^9}, {3.8329154722806787`*^9, 3.832915476772599*^9}, {
   3.832915570542097*^9, 3.8329156282965984`*^9}, {3.832915661051976*^9, 
   3.832915761196766*^9}, {3.832915854105765*^9, 3.8329158545000343`*^9}, 
   3.8329159284747925`*^9, {3.832916038039627*^9, 3.8329160794187365`*^9}, {
   3.8329163010990877`*^9, 3.832916338590598*^9}, {3.8329259282106915`*^9, 
   3.8329260088439074`*^9}, 3.832972206505047*^9, {3.832972578645569*^9, 
   3.8329726211552844`*^9}, {3.832972657934229*^9, 3.832972679476902*^9}, {
   3.8329736515768385`*^9, 3.8329737181620116`*^9}, 3.8329741272349186`*^9, {
   3.8329748391562*^9, 3.8329749519685273`*^9}, {3.832975049742714*^9, 
   3.832975244861807*^9}, {3.832975309946328*^9, 3.83297533243433*^9}, 
   3.8329756992236834`*^9, {3.832976036868046*^9, 3.8329761084378605`*^9}, {
   3.832976280222788*^9, 3.832976289341758*^9}, 3.832976363090472*^9, {
   3.8329765164379635`*^9, 3.832976669459014*^9}, {3.8329767064390707`*^9, 
   3.8329767102798*^9}, {3.832976768979664*^9, 3.8329767693452764`*^9}, {
   3.8329862161456156`*^9, 3.8329862746932898`*^9}, 3.832986319260833*^9, {
   3.8329866236605783`*^9, 3.8329866940199547`*^9}, {3.8329867396457815`*^9, 
   3.8329867817967525`*^9}, {3.8329868429093847`*^9, 3.832986848447735*^9}, {
   3.8329869121904964`*^9, 3.8329869216406126`*^9}, {3.8329869590106916`*^9, 
   3.8329869845563993`*^9}, {3.8329870710350056`*^9, 
   3.8329870868271523`*^9}, {3.832987117777122*^9, 3.8329871304494476`*^9}, {
   3.8329871840840254`*^9, 3.83298719640114*^9}, {3.832987252110629*^9, 
   3.832987297680984*^9}, {3.8329875782121964`*^9, 3.8329876779974585`*^9}, 
   3.8329891108207664`*^9, 3.8329891509603167`*^9, {3.8329893124673257`*^9, 
   3.832989341889273*^9}, {3.832989372343317*^9, 3.832989380094492*^9}, {
   3.832989469023359*^9, 3.8329895116222334`*^9}, 3.832989550475444*^9, {
   3.8329895812925844`*^9, 3.8329896430291557`*^9}, 3.832989710389038*^9, {
   3.832989794380674*^9, 3.832989840515479*^9}, {3.8329900359119043`*^9, 
   3.8329900392269583`*^9}, 3.8329902300451517`*^9, {3.8329902850595045`*^9, 
   3.832990290634919*^9}, {3.832990400692901*^9, 3.8329904167990813`*^9}, {
   3.8329905340857077`*^9, 3.8329905519651194`*^9}, 3.832990814613847*^9, {
   3.8329909286939344`*^9, 3.832990970544267*^9}, {3.8329912138491836`*^9, 
   3.83299127662766*^9}, {3.8329913594125805`*^9, 3.8329913604285154`*^9}, 
   3.832991535927836*^9, {3.832991587536005*^9, 3.8329916363961196`*^9}, {
   3.8329917763022046`*^9, 3.832991806289969*^9}, {3.832992044473613*^9, 
   3.8329920639739323`*^9}, {3.83299238485332*^9, 3.8329923989212475`*^9}, {
   3.83299289699961*^9, 3.8329929313175583`*^9}, {3.832993059234866*^9, 
   3.8329931404701014`*^9}, {3.832993176216199*^9, 3.832993302041716*^9}, {
   3.832993332818115*^9, 3.832993374134757*^9}, {3.832993556022413*^9, 
   3.8329935579497795`*^9}, {3.8329935965431356`*^9, 
   3.8329935967349715`*^9}, {3.8329938447455964`*^9, 
   3.8329938490018787`*^9}, {3.8329941687479954`*^9, 
   3.8329942177993145`*^9}, {3.832994320512024*^9, 3.83299432882345*^9}, {
   3.8329943747957373`*^9, 3.8329944018957214`*^9}, 3.8329946066161766`*^9, {
   3.8329948156526885`*^9, 3.83299486356558*^9}, {3.832994928855524*^9, 
   3.8329949310471373`*^9}, {3.8329954643185854`*^9, 
   3.8329955703042583`*^9}, {3.8329975892542048`*^9, 
   3.8329976034978075`*^9}, {3.832997720467806*^9, 3.8329977384848337`*^9}, {
   3.832997825146538*^9, 3.832997972287462*^9}, {3.832999139865249*^9, 
   3.832999151009587*^9}, {3.832999523891568*^9, 3.832999579518628*^9}, {
   3.8329997835944915`*^9, 3.8329998096426773`*^9}, {3.832999861059485*^9, 
   3.8329998665428133`*^9}, {3.832999901518716*^9, 3.8329999035050645`*^9}, {
   3.832999965715056*^9, 3.8329999659628916`*^9}, {3.833000248057844*^9, 
   3.8330002703796377`*^9}, {3.8330086307851515`*^9, 
   3.8330086314800177`*^9}, {3.8330116721059823`*^9, 3.8330116901242375`*^9}, 
   3.8330118144119864`*^9},
 CellLabel->
  "In[1075]:=",ExpressionUUID->"de46ef57-a359-4ec4-a7d3-aea9f5198032"],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`leftWallHeight$$ = 
    1, $CellContext`lightCenter$$ = {-2.5, 1.5}, $CellContext`lightFadeEnd$$ =
     5, $CellContext`lightFadeStart$$ = 3, $CellContext`lightIntensity$$ = 
    1, $CellContext`newEnergyPercent$$ = 
    0.3205859487415494, $CellContext`rightWallHeight$$ = 
    1, $CellContext`roughness$$ = 
    0.1, $CellContext`shadingPosX$$ = -1, $CellContext`viewAngle$$ = 
    Rational[1, 4] Pi, Typeset`show$$ = True, Typeset`bookmarkList$$ = {}, 
    Typeset`bookmarkMode$$ = "Menu", Typeset`animator$$, Typeset`animvar$$ = 
    1, Typeset`name$$ = "\"untitled\"", Typeset`specs$$ = {{{
       Hold[$CellContext`lightCenter$$], {-2.5, 1.5}}, {-4, -4}, {4, 4}}, {{
       Hold[$CellContext`lightFadeStart$$], 3}, 1, 3}, {{
       Hold[$CellContext`lightFadeEnd$$], 5}, 3, 20}, {{
       Hold[$CellContext`lightIntensity$$], 1}, 1, 10}, {{
       Hold[$CellContext`leftWallHeight$$], 1}, 0, 2}, {{
       Hold[$CellContext`rightWallHeight$$], 1}, 0, 2}, {{
       Hold[$CellContext`viewAngle$$], Rational[1, 4] Pi}, 0, Pi}, {
      Hold[$CellContext`newEnergyPercent$$], 0.3205859487415494}, {{
       Hold[$CellContext`roughness$$], 0.1}, 0.05, 1}, {{
       Hold[$CellContext`shadingPosX$$], -1}, -2, 2}}, Typeset`size$$ = {
    242., {52., 58.}}, Typeset`update$$ = 0, Typeset`initDone$$, 
    Typeset`skipInitDone$$ = True, $CellContext`lightCenter$713275$$ = {0, 
    0}, $CellContext`lightFadeStart$713276$$ = 
    0, $CellContext`lightFadeEnd$713277$$ = 
    0, $CellContext`lightIntensity$713278$$ = 
    0, $CellContext`leftWallHeight$713279$$ = 
    0, $CellContext`rightWallHeight$713280$$ = 
    0, $CellContext`viewAngle$713281$$ = 0, $CellContext`roughness$713282$$ = 
    0, $CellContext`shadingPosX$713283$$ = 0}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`leftWallHeight$$ = 
        1, $CellContext`lightCenter$$ = {-2.5, 
         1.5}, $CellContext`lightFadeEnd$$ = 5, $CellContext`lightFadeStart$$ = 
        3, $CellContext`lightIntensity$$ = 
        1, $CellContext`newEnergyPercent$$ = $CellContext`energyPercent, \
$CellContext`rightWallHeight$$ = 1, $CellContext`roughness$$ = 
        0.1, $CellContext`shadingPosX$$ = -1, $CellContext`viewAngle$$ = 
        Rational[1, 4] Pi}, "ControllerVariables" :> {
        Hold[$CellContext`lightCenter$$, $CellContext`lightCenter$713275$$, {
         0, 0}], 
        Hold[$CellContext`lightFadeStart$$, \
$CellContext`lightFadeStart$713276$$, 0], 
        Hold[$CellContext`lightFadeEnd$$, $CellContext`lightFadeEnd$713277$$, 
         0], 
        Hold[$CellContext`lightIntensity$$, \
$CellContext`lightIntensity$713278$$, 0], 
        Hold[$CellContext`leftWallHeight$$, \
$CellContext`leftWallHeight$713279$$, 0], 
        Hold[$CellContext`rightWallHeight$$, \
$CellContext`rightWallHeight$713280$$, 0], 
        Hold[$CellContext`viewAngle$$, $CellContext`viewAngle$713281$$, 0], 
        Hold[$CellContext`roughness$$, $CellContext`roughness$713282$$, 0], 
        Hold[$CellContext`shadingPosX$$, $CellContext`shadingPosX$713283$$, 
         0]}, "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, "Body" :> ($CellContext`oldLightSg2D = N[
          
          sgCommon`sgSphereLight[$CellContext`lightCenter$$, \
$CellContext`lightFadeStart$$, $CellContext`lightFadeEnd$$, \
$CellContext`lightIntensity$$, {$CellContext`shadingPosX$$, 
            0}]]; $CellContext`oldLightSg3D = 
        sgCommon`sgTo3D[$CellContext`oldLightSg2D]; $CellContext`bentCone = N[
          
          gUtils`gCreateCone[{$CellContext`shadingPosX$$, 
            0}, {-2, $CellContext`leftWallHeight$$}, {
           2, $CellContext`rightWallHeight$$}]]; $CellContext`coneTheta2D = N[
          Part[$CellContext`bentCone, 1]]; $CellContext`coneAperture = N[
          Part[$CellContext`bentCone, 2]]; $CellContext`coneCapAxis = N[{
           Cos[$CellContext`coneTheta2D], 0, 
           
           Sin[$CellContext`coneTheta2D]}]; $CellContext`coneCap = \
{$CellContext`coneCapAxis, $CellContext`coneAperture}; \
$CellContext`energyPercent = N[
          
          sgCommon`sgCapIntsEnergyPercent[$CellContext`oldLightSg3D, \
$CellContext`coneCap]]; $CellContext`newLightSg2D = {
          Part[$CellContext`oldLightSg2D, 1], 
          Part[$CellContext`oldLightSg2D, 2], $CellContext`energyPercent 
          Part[$CellContext`oldLightSg2D, 3]}; gPlots`gParamPlot[
         Association[
          ("circles" -> {
            Association[
            "center" -> Slot["lightCenter"], "radius" -> 
             Slot["lightFadeStart"]]}& )[
           Association[
           "lightCenter" -> $CellContext`lightCenter$$, 
            "lightFadeStart" -> $CellContext`lightFadeStart$$]], 
          ("lines" -> {
            Association[
            "startPos" -> {-2, 0}, "dirVec" -> {1, 0}, "length" -> 4, "color" -> 
             Green, "thickness" -> 0.015], 
            Association[
            "startPos" -> {-2, 0}, "dirVec" -> {0, 1}, "length" -> 
             Slot["leftWallHeight"], "color" -> Green, "thickness" -> 0.015], 
            Association[
            "startPos" -> {2, 0}, "dirVec" -> {0, 1}, "length" -> 
             Slot["rightWallHeight"], "color" -> Green, "thickness" -> 
             0.015]}& )[
           Association[
           "leftWallHeight" -> $CellContext`leftWallHeight$$, 
            "rightWallHeight" -> $CellContext`rightWallHeight$$]], 
          ("sgGroundShadingWithWalls" -> {
            Association[
            "lightCenter" -> Slot["lightCenter"], "lightFadeStart" -> 
             Slot["lightFadeStart"], "lightFadeEnd" -> Slot["lightFadeEnd"], 
             "wallXRange" -> {-2, 2}, "wallHeights" -> {
               Slot["leftWallHeight"], 
               Slot["rightWallHeight"]}, "lightIntensity" -> 
             Slot["lightIntensityCtrl"], "roughness" -> Slot["roughness"], 
             "viewDir" -> FromPolarCoordinates[{1, 
                Slot["viewAngle"]}], "sgLightFunc" -> (sgCommon`sgSphereLight[
               Slot["lightCenter"], 
               Slot["lightFadeStart"], 
               Slot["lightFadeEnd"], 
               Slot["lightIntensity"], 
               Slot["shadingPos"]]& ), "sgNDFFunc" -> (sgCommon`sgNDF[
               Slot["roughness"], 
               Slot["lightDir"], 
               Slot["viewDir"], 
               Slot["normalDir"]]& ), "sgShadingFunc" -> (1& ), 
             "bApplyEnergyPercent" -> True, "color" -> Blue, "label" -> 
             "Energy Percent Only"]}& )[
           Association[
           "lightCenter" -> $CellContext`lightCenter$$, 
            "lightFadeStart" -> $CellContext`lightFadeStart$$, 
            "lightFadeEnd" -> $CellContext`lightFadeEnd$$, 
            "lightIntensityCtrl" -> $CellContext`lightIntensity$$, 
            "viewAngle" -> $CellContext`viewAngle$$, 
            "leftWallHeight" -> $CellContext`leftWallHeight$$, 
            "rightWallHeight" -> $CellContext`rightWallHeight$$, 
            "roughness" -> $CellContext`roughness$$]], "axisExtent" -> 5]]), 
      "Specifications" :> {{{$CellContext`lightCenter$$, {-2.5, 
          1.5}}, {-4, -4}, {4, 4}}, {{$CellContext`lightFadeStart$$, 3}, 1, 
         3}, {{$CellContext`lightFadeEnd$$, 5}, 3, 
         20}, {{$CellContext`lightIntensity$$, 1}, 1, 
         10}, {{$CellContext`leftWallHeight$$, 1}, 0, 
         2}, {{$CellContext`rightWallHeight$$, 1}, 0, 
         2}, {{$CellContext`viewAngle$$, Rational[1, 4] Pi}, 0, 
         Pi}, {$CellContext`newEnergyPercent$$, $CellContext`energyPercent}, \
{{$CellContext`roughness$$, 0.1}, 0.05, 
         1}, {{$CellContext`shadingPosX$$, -1}, -2, 2}}, 
      "Options" :> {Method -> {"ShowControls" -> False}}, 
      "DefaultOptions" :> {}],
     ImageSizeCache->{610., {182., 188.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UndoTrackedVariables:>{Typeset`show$$, Typeset`bookmarkMode$$},
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{
  3.8329977399788322`*^9, 3.8329979060500507`*^9, {3.832997936665881*^9, 
   3.8329979736637974`*^9}, {3.8329991424643955`*^9, 3.8329991766754675`*^9}, 
   3.8329994683479652`*^9, 3.832999761543423*^9, 3.8329998108976097`*^9, {
   3.832999857946097*^9, 3.8329999107789373`*^9}, {3.8329999551235633`*^9, 
   3.8329999669484015`*^9}, 3.833000009911268*^9, {3.833000169812792*^9, 
   3.833000176514431*^9}, {3.833000256209033*^9, 3.8330002765903144`*^9}, {
   3.8330003385785174`*^9, 3.8330003425456457`*^9}, {3.8330004210520225`*^9, 
   3.8330004264910135`*^9}, 3.8330006408924017`*^9, 3.8330008264183965`*^9, 
   3.833000989099781*^9, 3.8330016776053667`*^9, 3.8330023468640633`*^9, 
   3.833008459528534*^9, 3.8330085387759247`*^9, {3.833008587150305*^9, 
   3.8330086231263037`*^9}, 3.833011691072087*^9, 3.833011818343268*^9},
 CellLabel->
  "Out[1083]=",ExpressionUUID->"752cf0a0-2e9e-4b3d-8d14-838e8c49971b"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"sgFindMinLambda", "[", "0.01", "]"}]], "Input",
 CellChangeTimes->{{3.83301238721313*^9, 3.833012388902811*^9}},
 CellLabel->
  "In[1097]:=",ExpressionUUID->"82ce0593-ba5e-4dbf-a128-4c4ca4ed1ae6"],

Cell[BoxData["4.605170185988092`"], "Output",
 CellChangeTimes->{3.8330123894389577`*^9},
 CellLabel->
  "Out[1097]=",ExpressionUUID->"3fea1213-7210-4b75-bc23-21c53247a8c2"]
}, Open  ]]
},
WindowSize->{1083, 672},
WindowMargins->{{280, Automatic}, {130, Automatic}},
FrontEndVersion->"12.0 for Microsoft Windows (64-bit) (April 8, 2019)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 17909, 389, 1473, "Input",ExpressionUUID->"de46ef57-a359-4ec4-a7d3-aea9f5198032"],
Cell[18492, 413, 9377, 173, 389, "Output",ExpressionUUID->"752cf0a0-2e9e-4b3d-8d14-838e8c49971b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[27906, 591, 220, 4, 28, "Input",ExpressionUUID->"82ce0593-ba5e-4dbf-a128-4c4ca4ed1ae6"],
Cell[28129, 597, 173, 3, 32, "Output",ExpressionUUID->"3fea1213-7210-4b75-bc23-21c53247a8c2"]
}, Open  ]]
}
]
*)

